version: "3.8"

services:
    server:
        image: boxial:client-server
        container: boxial-client-server
        networks:
            - frontend
        build:
            context: src/server
            dockerfile: config/Dockerfile.server
    frontend:
        image: boxial:client-frontend
        container: boxial-client-frontend
        networks:
            - frontend
        build: 
            context: src/frontend
            dockerfile: config/Dockerfile.frontend
    backend:
        image: boxial:client-backend
        container: boxial-client-backend
        networks:
            - frontend
            - backend
        build: 
            context: src/backend
            dockerfile: config/Dockerfile.backend
        ports: 
            - "6001:3000"
        environment:
            - NODE_PORT=3000
            - MYSQL_NAME=boxial
    database:
        image: mariadb
        container: boxial-client-database
        environment:
            - MYSQL_ROOT_PASSWORD=none
            - MYSQL_DATABASE=boxial
        networks:
            - backend
        restart: on-failure
        volumes:
            - ${PWD}/data:/data/db      
            - ${PWD}/src/database:/docker-entrypoint-initdb.d

networks:
    frontend:
        driver: bridge         
    backend:
        driver: bridge